generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum PropertyType {
  Apartment
  House
  Villa
  Office
  Commercial
  Land
  Building
  Studio
  Duplex
}

enum UserRole {
  USER
  AGENT
  ADMIN
}

// ============================================
// NextAuth.js Required Models
// ============================================


model OTPToken {
  id         String   @id @default(uuid())
  email      String
  token      String   // 6-digit OTP code
  type       OTPType
  expires    DateTime
  createdAt  DateTime @default(now())
  
  @@unique([email, token])
  @@index([email])
  @@index([expires])
}

enum OTPType {
  EMAIL_VERIFICATION
  PASSWORD_RESET
  LOGIN_VERIFICATION
}


model User {
  id            String    @id @default(uuid())
  email         String    @unique
  name          String?
  password      String?   // hashed password
  emailVerified DateTime?
  image         String?
  role          UserRole  @default(USER)
  
  accounts      Account[]
  sessions      Session[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

model Account {
  id                String  @id @default(uuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String? @db.Text
  access_token      String? @db.Text
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String? @db.Text
  session_state     String?

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(uuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}


model Region {
  Id_Reg        Int           @id @default(autoincrement())
  Nom_Reg       String?
  Sup_Reg       Float?
  Chef_lieu_Reg String?
  WKT_Geometry  String?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  departements  Departement[]
}

model Departement {
  Id_Dept         Int              @id @default(autoincrement())
  Nom_Dept        String?
  Sup_Dept        Float?
  Chef_lieu_Dept  String?
  Id_Reg          Int?
  WKT_Geometry    String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  region          Region?          @relation(fields: [Id_Reg], references: [Id_Reg])
  arrondissements Arrondissement[]
}

model Arrondissement {
  Id_Arrond        Int           @id @default(autoincrement())
  Nom_Arrond       String?
  Sup_Arrond       Float?
  Chef_lieu_Arrond String?
  Commune          String?
  Id_Dept          Int?
  WKT_Geometry     String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  departement      Departement?  @relation(fields: [Id_Dept], references: [Id_Dept])
  lotissements     Lotissement[]
}

model Lotissement {
  Id_Lotis       Int             @id @default(autoincrement())
  Nom_proprio    String?
  Num_TF         String?
  Statut         String?
  Nom_cons       String?
  Surface        Float?
  Nom_visa_lotis String?
  Date_approb    DateTime?       @db.Date
  Geo_exe        String?
  Nbre_lots      Int?
  Lieudit        String?
  Echelle        Int?
  Ccp            String?
  
  // Pricing fields for Lotissement
  price          Decimal?        @db.Decimal(15, 2)
  pricePerSqM    Decimal?        @db.Decimal(15, 2) // Price per square meter
  currency       String?         @default("XAF")
  forSale        Boolean?        @default(false)
  forRent        Boolean?        @default(false)
  rentPrice      Decimal?        @db.Decimal(15, 2) // Monthly rent if applicable
  shortDescription String?       @db.VarChar(255)
  description    String?         @db.Text
  published      Boolean?        @default(false)
  featured       Boolean?        @default(false)
  
  Video_URL      String?
  Image_URL_1    String?
  Image_URL_2    String?
  Image_URL_3    String?
  Image_URL_4    String?
  Image_URL_5    String?
  Image_URL_6    String?
  Id_Arrond      Int?
  WKT_Geometry   String?
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  arrondissement Arrondissement? @relation(fields: [Id_Arrond], references: [Id_Arrond])
  parcelles      Parcelle[]
  limitrophes    Limitrophe[]
  
  @@index([price])
  @@index([forSale])
  @@index([forRent])
  @@index([published])
}

model Parcelle {
  Id_Parcel    Int          @id @default(autoincrement())
  Nom_Prop     String?
  TF_Mere      String?
  Mode_Obtent  String?
  TF_Cree      String?
  Nom_Cons     String?
  Sup          Float?
  Nom_Visa_Cad String?
  Date_visa    DateTime?    @db.Date
  Geometre     String?
  Date_impl    DateTime?    @db.Date
  Num_lot      String?
  Num_bloc     String?
  Lieu_dit     String?
  Largeur_Rte  String?
  Echelle      Int?
  Ccp_N        String?
  Mise_Val     Boolean?
  Cloture      Boolean?
  
  // Pricing fields for Parcelle (land)
  price          Decimal?     @db.Decimal(15, 2)
  pricePerSqM    Decimal?     @db.Decimal(15, 2) // Price per square meter
  currency       String?      @default("XAF")
  forSale        Boolean?     @default(false)
  forRent        Boolean?     @default(false)
  rentPrice      Decimal?     @db.Decimal(15, 2) // Monthly rent if applicable
  shortDescription String?    @db.VarChar(255)
  description    String?      @db.Text
  published      Boolean?     @default(false)
  featured       Boolean?     @default(false)
  
  Video_URL    String?
  Image_URL_1  String?
  Image_URL_2  String?
  Image_URL_3  String?
  Image_URL_4  String?
  Image_URL_5  String?
  Image_URL_6  String?
  Id_Lotis     Int?
  WKT_Geometry String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  properties   Property[]
  lotissement  Lotissement? @relation(fields: [Id_Lotis], references: [Id_Lotis])
  batiments    Batiment[]
  payers       Payer[]
  contenirs    Contenir[]
  trouvrs      Trouver[]
  eclairers    Eclairer[]
  desservirs   Desservir[]
  
  @@index([price])
  @@index([forSale])
  @@index([forRent])
  @@index([published])
}

model Batiment {
  Id_Bat          Int              @id @default(autoincrement())
  Type_Usage      String?
  Cat_Bat         String?
  Status          String?
  Standing        String?
  Cloture         Boolean?
  No_Permis       String?
  Type_Lodg       String?
  Etat_Bat        String?
  Nom             String?
  Mat_Bati        String?
  
  // Physical features of the building
  bedrooms        Int?             // Total bedrooms in building
  bathrooms       Int?             // Total bathrooms
  kitchens        Int?             // Number of kitchens
  livingRooms     Int?             // Number of living rooms
  totalFloors     Int?             // Number of floors in building
  totalUnits      Int?             // Number of units (for apartment buildings)
  hasElevator     Boolean?         @default(false)
  hasGenerator    Boolean?         @default(false)
  hasParking      Boolean?         @default(false)
  parkingSpaces   Int?             // Number of parking spaces
  
  // Pricing fields for Batiment
  price           Decimal?         @db.Decimal(15, 2)
  pricePerSqM     Decimal?         @db.Decimal(15, 2) // Price per square meter
  currency        String?          @default("XAF")
  forSale         Boolean?         @default(false)
  forRent         Boolean?         @default(false)
  rentPrice       Decimal?         @db.Decimal(15, 2) // Monthly rent if applicable
  shortDescription String?         @db.VarChar(255)
  description     String?          @db.Text
  published       Boolean?         @default(false)
  featured        Boolean?         @default(false)
  
  Video_URL       String?
  Image_URL_1     String?
  Image_URL_2     String?
  Image_URL_3     String?
  Image_URL_4     String?
  Image_URL_5     String?
  Image_URL_6     String?
  Id_Parcel       Int?
  WKT_Geometry    String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  properties      Property[]
  parcelle        Parcelle?        @relation(fields: [Id_Parcel], references: [Id_Parcel])
  payers          Payer[]
  alimenters      Alimenter[]
  approvisionners Approvisionner[]
  
  @@index([price])
  @@index([forSale])
  @@index([forRent])
  @@index([published])
}

model Route {
  Id_Rte       Int         @id @default(autoincrement())
  Cat_Rte      String?
  Type_Rte     String?
  Largeur_Rte  String?
  Etat_Rte     String?
  Mat_Rte      String?
  WKT_Geometry String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  desservirs   Desservir[]
}

model Riviere {
  Id_Riv       Int          @id @default(autoincrement())
  Nom_Riv      String?
  Type_Riv     String?
  Etat_amenag  String?
  Debit_Riv    String?
  WKT_Geometry String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
  limitrophes  Limitrophe[]
}

model Taxe_immobiliere {
  Id_Taxe       Int       @id @default(autoincrement())
  Num_TF        String?
  Nom_Proprio   String?
  NIU           String?
  Val_imm       Float?
  Taxe_Payee    Boolean?
  Date_declaree DateTime? @db.Date
  Type_taxe     String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  payers        Payer[]
}

model Equipement {
  Id_Equip     Int        @id @default(autoincrement())
  Type_Equip   String?
  Design_Equip String?
  Etat_Equip   String?
  Mat_Equip    String?
  WKT_Geometry String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  eclairers    Eclairer[]
}

model Reseau_energetique {
  Id_Reseaux   Int         @id @default(autoincrement())
  Source_Res   Float?
  Type_Reseau  String?
  Etat_Res     String?
  Materiau     String?
  WKT_Geometry String?
  createdAt    DateTime    @default(now())
  updatedAt    DateTime    @updatedAt
  alimenters   Alimenter[]
}

model Reseau_en_eau {
  Id_Reseaux      Int              @id @default(autoincrement())
  Source_Res      Float?
  Type_Res        String?
  Etat_Res        String?
  Mat_Res         String?
  WKT_Geometry    String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  approvisionners Approvisionner[]
}

model Infrastructure {
  Id_Infras        Int       @id @default(autoincrement())
  Nom_infras       String?
  Type_Infraas     String?
  Categorie_infras String?
  Cycle            String?
  Statut_infras    String?
  Standing         String?
  Video_URL        String?
  Image_URL_1      String?
  Image_URL_2      String?
  Image_URL_3      String?
  Image_URL_4      String?
  Image_URL_5      String?
  Image_URL_6      String?
  WKT_Geometry     String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  trouvrs          Trouver[]
}

model Borne {
  Id_Borne     Int        @id @default(autoincrement())
  coord_x      Float?
  coord_y      Float?
  coord_z      Float?
  WKT_Geometry String?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
  contenirs    Contenir[]
}

// Relationship Models
model Payer {
  Id_Parcel Int
  Id_Bat    Int
  Id_Taxe   Int
  date_paye Int?
  createdAt DateTime         @default(now())
  updatedAt DateTime         @updatedAt

  parcelle Parcelle         @relation(fields: [Id_Parcel], references: [Id_Parcel])
  batiment Batiment         @relation(fields: [Id_Bat], references: [Id_Bat])
  taxe     Taxe_immobiliere @relation(fields: [Id_Taxe], references: [Id_Taxe])

  @@id([Id_Parcel, Id_Bat, Id_Taxe])
}

model Limitrophe {
  Id_Lotis  Int
  Id_Riv    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  lotissement Lotissement @relation(fields: [Id_Lotis], references: [Id_Lotis])
  riviere     Riviere     @relation(fields: [Id_Riv], references: [Id_Riv])

  @@id([Id_Lotis, Id_Riv])
}

model Alimenter {
  Id_Bat     Int
  Id_Reseaux Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  batiment          Batiment           @relation(fields: [Id_Bat], references: [Id_Bat])
  reseauEnergetique Reseau_energetique @relation(fields: [Id_Reseaux], references: [Id_Reseaux])

  @@id([Id_Bat, Id_Reseaux])
}

model Contenir {
  Id_Parcel Int
  Id_Borne  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parcelle Parcelle @relation(fields: [Id_Parcel], references: [Id_Parcel])
  borne    Borne    @relation(fields: [Id_Borne], references: [Id_Borne])

  @@id([Id_Parcel, Id_Borne])
}

model Trouver {
  Id_Parcel Int
  Id_Infras Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parcelle       Parcelle       @relation(fields: [Id_Parcel], references: [Id_Parcel])
  infrastructure Infrastructure @relation(fields: [Id_Infras], references: [Id_Infras])

  @@id([Id_Parcel, Id_Infras])
}

model Eclairer {
  Id_Parcel Int
  Id_Equip  Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parcelle   Parcelle   @relation(fields: [Id_Parcel], references: [Id_Parcel])
  equipement Equipement @relation(fields: [Id_Equip], references: [Id_Equip])

  @@id([Id_Parcel, Id_Equip])
}

model Desservir {
  Id_Parcel Int
  Id_Rte    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  parcelle Parcelle @relation(fields: [Id_Parcel], references: [Id_Parcel])
  route    Route    @relation(fields: [Id_Rte], references: [Id_Rte])

  @@id([Id_Parcel, Id_Rte])
}

model Approvisionner {
  Id_Bat     Int
  Id_Reseaux Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  batiment    Batiment      @relation(fields: [Id_Bat], references: [Id_Bat])
  reseauEnEau Reseau_en_eau @relation(fields: [Id_Reseaux], references: [Id_Reseaux])

  @@id([Id_Bat, Id_Reseaux])
}

model Property {
  id                    Int          @id @default(autoincrement())
  title                 String
  shortDescription      String?      @db.VarChar(255)
  description           String?      @db.Text
  price                 Decimal      @db.Decimal(15, 2)
  currency              String       @default("XAF")

  // Property type
  type                  PropertyType

  // For sale/rent specifics
  forSale               Boolean      @default(true)
  forRent               Boolean      @default(false)
  rentPrice             Decimal?     @db.Decimal(15, 2)

  // Land for development
  isLandForDevelopment  Boolean      @default(false)
  approvedForApartments Boolean?

  // Rooms & features
  bedrooms              Int?
  bathrooms             Int?
  kitchens              Int?         @default(1)
  livingRooms           Int?         @default(1)
  hasGenerator          Boolean?     @default(false)
  hasParking            Boolean?     @default(false)
  floorLevel            Int?
  totalFloors           Int?

  // Location references
  parcelleId            Int
  batimentId            Int?

  // Relations
  parcelle              Parcelle     @relation(fields: [parcelleId], references: [Id_Parcel])
  batiment              Batiment?    @relation(fields: [batimentId], references: [Id_Bat])

  // Images & media
  imageUrl1             String?
  imageUrl2             String?
  imageUrl3             String?
  imageUrl4             String?
  imageUrl5             String?
  imageUrl6             String?
  videoUrl              String?

  // Automatic timestamps
  createdAt             DateTime     @default(now())
  updatedAt             DateTime     @updatedAt

  // Status
  published             Boolean      @default(false)
  featured              Boolean      @default(false)

  @@index([parcelleId])
  @@index([batimentId])
  @@index([type])
  @@index([price])
  @@index([published])
  @@index([createdAt])
}